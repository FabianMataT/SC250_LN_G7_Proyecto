{% extends 'base.html' %}

{% block title %}Gestor de Archivos{% endblock %}

{% block content %}
<!-- Fondo full screen con gradiente suave y animaciones sutiles -->
<div class="min-h-screen w-full bg-gradient-to-tr from-teal-900 via-teal-800 to-teal-700 flex items-center justify-center px-6 py-16 relative overflow-hidden">
  
  <!-- Elementos flotantes animados (blur y movimiento) -->
  <div class="absolute top-24 left-12 w-44 h-44 bg-teal-400/20 rounded-full blur-3xl animate-blob"></div>
  <div class="absolute bottom-24 right-12 w-56 h-56 bg-teal-500/15 rounded-full blur-4xl animate-blob animation-delay-4000"></div>
  <div class="absolute top-1/2 left-1/3 w-36 h-36 bg-teal-300/30 rounded-full blur-2xl animate-blob animation-delay-2000"></div>

  <!-- Contenedor principal (tarjeta blanca con blur y sombra) -->
  <div
    class="relative bg-white/95 backdrop-blur-md rounded-3xl shadow-2xl border border-teal-300/40 p-14 max-w-3xl w-full
           flex flex-col"
  >
    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-5xl font-extrabold text-teal-800 mb-2 tracking-tight select-none">
        Gestor de Archivos
      </h1>
      <p class="text-teal-600 text-lg sm:text-xl font-light">
        Sube y administra tus archivos CSV y Excel f√°cilmente
      </p>
    </header>

    <!-- Upload Form -->
    <form method="POST" enctype="multipart/form-data" class="mb-12 space-y-8">
      <label for="file"
        class="relative block w-full cursor-pointer border-4 border-dashed border-teal-400 rounded-3xl bg-teal-50 hover:bg-teal-100 transition duration-400 p-10 text-center flex flex-col items-center justify-center gap-3 select-none shadow-inner hover:shadow-lg"
      >
        <input id="file" type="file" name="file" accept=".csv, .xlsx, .xls"
          class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30" required>
        <span class="text-7xl pointer-events-none select-none">üìÑ</span>
        <span class="text-lg text-teal-700 font-semibold pointer-events-none tracking-wide">
          Arrastra tu archivo aqu√≠ o haz clic para seleccionar
        </span>
      </label>
      <div class="flex justify-center">
        <button type="submit"
          class="inline-flex items-center gap-3 bg-gradient-to-r from-teal-600 to-teal-500 hover:from-teal-700 hover:to-teal-600
                 text-white rounded-full px-10 py-4 font-semibold text-xl shadow-lg transition duration-400 focus:outline-none focus:ring-6 focus:ring-teal-300"
        >
          <span>Subir Archivo</span>
        </button>
      </div>
    </form>

    <!-- Files List -->
    <section>
      <h2 class="flex items-center gap-4 text-teal-700 font-semibold text-2xl mb-8 select-none">
        <span>üìÅ</span> Archivos cargados
      </h2>

      <div class="max-h-[24rem] overflow-y-auto space-y-6 pr-4 scrollbar-thin scrollbar-thumb-teal-400 scrollbar-track-teal-100">
        {% for file in files %}
        <div
          class="flex justify-between items-center bg-gradient-to-r from-teal-100 to-teal-50 border border-teal-300 rounded-3xl p-6
                 shadow-md hover:shadow-2xl transition duration-300 group select-text"
        >
          <div class="flex items-center gap-6">
            <div
              class="w-14 h-14 rounded-xl bg-gradient-to-tr from-teal-600 to-teal-400 flex items-center justify-center text-white text-4xl select-none"
              title="{{ file.name }}"
            >
              {% if file.name.endswith('.csv') %}üìä{% else %}üìà{% endif %}
            </div>
            <div class="flex flex-col max-w-lg">
              <span
                class="font-semibold text-teal-700 truncate max-w-full"
                title="{{ file.name }}"
              >{{ file.name }}</span>
              <span class="text-sm text-teal-500">
                {% if file.name.endswith('.csv') %}Archivo CSV{% else %}Archivo Excel{% endif %}
              </span>
            </div>
          </div>
          <form method="POST" action="{{ url_for('main.delete_file', file_id=file.id) }}" class="delete-form">
            <button type="submit"
              class="text-red-600 hover:text-red-800 p-3 rounded-xl transition-opacity duration-300 opacity-0 group-hover:opacity-100 focus:outline-none focus:ring-4 focus:ring-red-400"
              aria-label="Eliminar archivo {{ file.name }}">
              üóëÔ∏è
            </button>
          </form>
        </div>
        {% else %}
        <div
          class="text-center py-16 text-teal-400 select-none flex flex-col items-center justify-center gap-5"
        >
          <div
            class="w-24 h-24 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner"
          >
            <span class="text-4xl">üìÑ</span>
          </div>
          <p class="text-2xl font-light">No hay archivos cargados a√∫n</p>
          <p class="text-base mt-1 max-w-xs">
            Sube tu primer archivo CSV o Excel para comenzar
          </p>
        </div>
        {% endfor %}
      </div>
    </section>
    {% if analisis %}
    <hr class="my-10 border-teal-300">

    <section>
      <h2 class="flex items-center gap-4 text-teal-700 font-semibold text-2xl mb-8 select-none">
        <span>üìä</span> An√°lisis del archivo
      </h2>

      <div class="space-y-4">
        <p><strong>Filas y columnas:</strong> {{ analisis.shape }}</p>

        <h3 class="text-xl font-semibold text-teal-600">Tipos de variables</h3>
        <ul class="list-disc pl-6">
          {% for col, tipo in analisis.tipos.items() %}
            <li>{{ col }} ‚Üí {{ tipo }}</li>
          {% endfor %}
        </ul>

        <h3 class="text-xl font-semibold text-teal-600">Valores nulos</h3>
        <ul class="list-disc pl-6">
          {% for col, nulos in analisis.nulos.items() %}
            <li>{{ col }} ‚Üí {{ nulos }}</li>
          {% endfor %}
        </ul>

        <h3 class="text-xl font-semibold text-teal-600">Estad√≠sticas</h3>
        <pre class="bg-teal-50 p-4 rounded-lg overflow-x-auto text-sm">{{ analisis.estadisticas | tojson(indent=2) }}</pre>
      </div>
    </section>
    {% endif %}
  </div>
</div>


<script>
  document.querySelectorAll('.delete-form').forEach(form => {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      Swal.fire({
        title: '¬øEst√°s seguro?',
        text: '¬°Esta acci√≥n eliminar√° el archivo!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'S√≠, eliminar',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          localStorage.setItem('deleteSuccess', 'true');
          form.submit();
        }
      });
    });
  });

  document.getElementById('file').addEventListener('change', function () {
    if (this.files.length > 0) {
      // Optional: Aqu√≠ podr√≠as actualizar alg√∫n texto o estilo si quieres
    }
  });

  if (localStorage.getItem('deleteSuccess') === 'true') {
    Swal.fire({
      icon: 'success',
      title: 'Eliminado exitosamente',
      showConfirmButton: false,
      timer: 1500
    });
    localStorage.removeItem('deleteSuccess');
  }
</script>

<style>
  @keyframes blob {
    0%, 100% {
      transform: translate(0, 0) scale(1);
    }
    33% {
      transform: translate(30px, -20px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 30px) scale(0.9);
    }
  }

  .animate-blob {
    animation: blob 7s infinite;
  }

  .animation-delay-2000 {
    animation-delay: 2s;
  }

  .animation-delay-4000 {
    animation-delay: 4s;
  }

  /* Optional: Scrollbar estilizada para mejor UX */
  .scrollbar-thin::-webkit-scrollbar {
    width: 8px;
  }
  .scrollbar-thin::-webkit-scrollbar-track {
    background: #e0f2f1;
    border-radius: 9999px;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: #14b8a6;
    border-radius: 9999px;
  }
</style>

{% endblock %}
